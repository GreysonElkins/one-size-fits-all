<!DOCTYPE html>
<html>
  <body>
    <div id='player'></div>
    <div id='message-box'></div>
  </body>
  <script>
    const messageBox = document.getElementById('message-box')

    const ytAPI = document.createElement('script')
    ytAPI.src = "https://www.youtube.com/iframe_api"

    var firstScriptTag = document.getElementsByTagName('script')[0]
    firstScriptTag.parentNode.insertBefore(ytAPI, firstScriptTag)

    let player;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '390',
        width: '640',
        videoId: 'v3nb8Tmk6jM',
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      })
    }

    function onPlayerReady(event) {
      event.target.playVideo();
    } 
    
    let phase = 1;
    let username;

    function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING && phase === 1) {
          setTimeout(() => {
            askForName()
          }, 6000)
        } else if (event.data == YT.PlayerState.PLAYING && phase === 2) {
          setTimeout(() => {
            speak(username);
          }, 100)
        }
      }

    function messageUser(question, btnName, valueType) {
      messageBox.innerHTML = `<div>
          ${question} 
          <input type="textbox" id="${valueType}"/>
          <button id="${btnName}">Submit</button>
        </div>`
    }

    function clearMessage() {
      messageBox.innerHTML = ''
    }

    function askForName() {
        player.pauseVideo()
        messageUser(`what's your name?`, 'submit-username', 'user-value')
        const submit = document.getElementById('submit-username')
        submit.addEventListener('click', () => {
          saveUser()
          clearMessage()
          phase = 2
          player.playVideo()
        })
    }

    function saveUser(fromElement) {
        username = document.getElementById('user-value').value
    }
    
    function speak(words) {
      const msg = new SpeechSynthesisUtterance()
      msg.text = words
      window.speechSynthesis.speak(msg)
    }
    // no video? are you connected to the internet?

  </script>
</html>

